# 管理パネル - 機能と使用方法

## 概要

kerutaシステムの管理パネルは、システム管理者がタスク、ドキュメント、リポジトリ、ジョブ、およびKubernetes設定を管理するためのウェブインターフェースを提供します。管理パネルは認証が必要で、適切な権限を持つユーザーのみがアクセスできます。

## アクセス方法

管理パネルには以下のURLでアクセスできます：

```
http://localhost:8080/
```

アクセスするには、Keycloakで設定された有効な認証情報と適切な権限（admin権限）が必要です。認証の詳細については、[Keycloak統合ドキュメント](keycloak_integration.md)を参照してください。

## 機能

管理パネルは以下の主要な機能を提供します：

1. ダッシュボード
2. タスク管理
3. ドキュメント管理
4. リポジトリ管理
5. ジョブ管理
6. Kubernetes設定

### ダッシュボード

ダッシュボードは管理パネルのホーム画面で、システム内のすべてのタスクの概要を表示します。

- URL: `/`
- 機能：
  - すべてのタスクの一覧表示
  - タスク管理、ドキュメント管理、リポジトリ管理、ジョブ管理、Kubernetes設定へのナビゲーションリンク

### タスク管理

タスク管理機能では、システム内のタスクの作成、表示、編集、削除が可能です。タスクとジョブは統合されており、一つのタスクエンティティで管理されます。

- URL: `/tasks`
- 機能：
  - タスク一覧の表示
  - 新規タスクの作成
  - 既存タスクの編集
  - タスクの削除

#### タスク作成

- URL: `/tasks/create`
- 入力フィールド：
  - タイトル：タスクのタイトル
  - 説明：タスクの詳細説明
  - 優先度：タスクの優先度（数値）
  - ステータス：タスクの現在のステータス（PENDING、IN_PROGRESS、COMPLETED、CANCELLED、FAILED）
  - リポジトリ：タスクに関連するリポジトリ（一つのみ選択可能）
  - ドキュメント：タスクに関連するドキュメント（複数選択可能）
  - イメージ：タスク実行に使用するDockerイメージ
  - 名前空間：Kubernetes名前空間
  - リソース：CPUとメモリのリソース要件
  - 追加環境変数：タスク実行時に設定する追加の環境変数

#### タスク編集

- URL: `/tasks/edit/{id}`
- 入力フィールド：
  - タイトル：タスクのタイトル
  - 説明：タスクの詳細説明
  - 優先度：タスクの優先度（数値）
  - ステータス：タスクの現在のステータス（PENDING、IN_PROGRESS、COMPLETED、CANCELLED、FAILED）
  - リポジトリ：タスクに関連するリポジトリ（一つのみ選択可能）
  - ドキュメント：タスクに関連するドキュメント（複数選択可能）
  - イメージ：タスク実行に使用するDockerイメージ
  - 名前空間：Kubernetes名前空間
  - リソース：CPUとメモリのリソース要件
  - 追加環境変数：タスク実行時に設定する追加の環境変数

#### タスク削除

- URL: `/tasks/delete/{id}`
- 機能：指定されたIDのタスクをシステムから削除します

### ドキュメント管理

ドキュメント管理機能では、システム内のドキュメントの作成、表示、編集、削除が可能です。

- URL: `/documents`
- 機能：
  - ドキュメント一覧の表示
  - 新規ドキュメントの作成
  - 既存ドキュメントの編集
  - ドキュメントの削除

#### ドキュメント作成

- URL: `/documents/create`
- 入力フィールド：
  - タイトル：ドキュメントのタイトル
  - 内容：ドキュメントの本文
  - タグ：ドキュメントに関連するタグ（カンマ区切り）

#### ドキュメント編集

- URL: `/documents/edit/{id}`
- 入力フィールド：
  - タイトル：ドキュメントのタイトル
  - 内容：ドキュメントの本文
  - タグ：ドキュメントに関連するタグ

#### ドキュメント削除

- URL: `/documents/delete/{id}`
- 機能：指定されたIDのドキュメントをシステムから削除します

### リポジトリ管理

リポジトリ管理機能では、システム内のGitリポジトリの登録、表示、編集、削除が可能です。

- URL: `/repositories`
- 機能：
  - リポジトリ一覧の表示
  - 新規リポジトリの登録
  - 既存リポジトリの編集
  - リポジトリの削除

#### リポジトリ登録

- URL: `/repositories/create`
- 入力フィールド：
  - 名前：リポジトリの名前
  - URL：GitリポジトリのURL
  - 説明：リポジトリの説明

#### リポジトリ編集

- URL: `/repositories/edit/{id}`
- 入力フィールド：
  - 名前：リポジトリの名前
  - URL：GitリポジトリのURL
  - 説明：リポジトリの説明

#### リポジトリ削除

- URL: `/repositories/delete/{id}`
- 機能：指定されたIDのリポジトリをシステムから削除します

### ジョブ管理（非推奨）

**注意**: ジョブ管理機能は非推奨となりました。タスクとジョブは統合され、タスク管理機能を通じて一元的に管理されるようになりました。

以前のジョブ管理機能で提供されていた情報は、現在はタスク詳細画面で確認できます。タスク詳細画面では、以下の情報が表示されます：

- タスクID
- タイトル
- 説明
- 優先度
- ステータス
- 関連リポジトリ
- 関連ドキュメント
- 実行イメージ
- 名前空間
- ポッド名
- リソース要件
- 環境変数
- ログ情報
- 作成日時
- 更新日時

タスクの実行状況やログ情報は、タスク詳細画面で直接確認できます。

### Kubernetes設定

Kubernetes設定機能では、システムのKubernetes統合に関する設定の表示と更新が可能です。これらの設定はデータベースに保存され、システム全体で使用されます。

- URL: `/admin/kubernetes`
- 機能：
  - Kubernetes設定の表示
  - Kubernetes設定の更新

#### Kubernetes設定更新

- URL: `/admin/kubernetes/update`
- 入力フィールド：
  - 有効化：Kubernetes統合の有効/無効
  - 設定パス：Kubernetesの設定ファイルパス
  - クラスター内実行：クラスター内で実行するかどうか
  - デフォルト名前空間：デフォルトのKubernetes名前空間
  - デフォルトイメージ：タスク実行に使用するデフォルトのDockerイメージ
  - プロセッサー名前空間：ジョブプロセッサーが使用する名前空間

## セキュリティ考慮事項

1. **認証**: 管理パネルへのアクセスには、有効なKeycloak認証情報と適切な権限が必要です。

2. **権限**: 管理パネルの機能にアクセスするには、admin権限が必要です。

3. **セッション管理**: 不要になった場合は、必ずログアウトしてセッションを終了してください。

4. **安全な接続**: 本番環境では、管理パネルへのアクセスは常にHTTPS経由で行ってください。

## トラブルシューティング

1. **アクセスエラー**: 管理パネルにアクセスできない場合は、以下を確認してください：
   - 正しい認証情報を使用しているか
   - admin権限を持っているか
   - アプリケーションサーバーが実行中か

2. **機能エラー**: 特定の機能が動作しない場合は、以下を確認してください：
   - アプリケーションログでエラーメッセージを確認
   - 必要なサービス（MongoDB、Keycloakなど）が実行中か

3. **表示の問題**: UIが正しく表示されない場合は、以下を確認してください：
   - ブラウザのキャッシュをクリア
   - 最新のブラウザを使用しているか

## 制限事項

1. ドキュメントとリポジトリの管理機能は、現在メモリ内ストレージを使用しているため、アプリケーションの再起動時にデータが失われます。

2. Kubernetes設定の更新機能は、現在完全には実装されていません。

3. 管理パネルは基本的な機能のみを提供しており、高度なカスタマイズやフィルタリングオプションは限られています。
